<element-set>
  <element name="rpbody">
    <sql>
      <![CDATA[
      SELECT CONCAT_WS(' ', s.code, o.src_id) ordNum, oei.group_id, oei.date_in, oei.date_out, bt.name booktype, 
      		 CONCAT_WS(' ', bp.name, IF(pg.is_reprint = 1, 'Брак', '')) bookpart, oei.books,
      		 IF(pg.sub_id='', oei.calc_type, CONCAT_WS(' ', 'Онлайн редактор', bt.name)) calc_type, oei.cover, 
      		 oei.format, oei.cover_material, oei.endpaper, oei.corner_type, IFNULL(oei.paper, av.value) paper, oei.interlayer, 
      		 oei.kaptal, oei.sheets, oei.book_thickness, oei.remark, :pbarcode barcode
		FROM print_group pg
		  INNER JOIN orders o ON pg.order_id = o.id
		  INNER JOIN sources s ON o.source = s.id
		  INNER JOIN book_part bp ON bp.id = pg.book_part
		  INNER JOIN book_type bt ON bt.id = pg.book_type
		  LEFT OUTER JOIN attr_value av ON av.id = pg.paper
		  LEFT OUTER JOIN order_extra_info oei ON oei.id = pg.order_id
		    AND oei.sub_id = pg.sub_id
		WHERE pg.id = :pgid
	]]>
    </sql>
  </element>

</element-set>
